## Objetivo
Oracles can be your best friend, they will decrypt anything, except the flag's ciphertext. How will you break it? Connect with `nc mercury.picoctf.net 28517`.

## Pistas
- What can you do with a different pair of ciphertext and plaintext? What if it is not so different after all...

## Solución
```
┌──(kali㉿kali)-[~]
└─$ nc mercury.picoctf.net 28517
Welcome to the Padding Oracle Challenge
This oracle will take anything you give it and decrypt using RSA. It will not accept the ciphertext with the secret message... Good Luck!


n: 112907822242451296917676048018400996425281409975529707139869250347104961289704198494730939459405888872044380040266711911630406472014199906846492479077809502733168208796710006743501821732158122410708851299109278185721511356098603228335796244141258119829206541735501307744326527139749660186242983991736060057817
e: 65537
ciphertext: 70338334668153031587170561990034911675519867043548011437427936338101374270908715553123927576151084025460206446656354937442979002172332444120167322234504501639052704576058561765627438098752323442002866129234686728248058149294686974734863237492928397175317544358452938151933557861803500069719437211045883256667


Give me ciphertext to decrypt: 70338334668153031587170561990034911675519867043548011437427936338101374270908715553123927576151084025460206446656354937442979002172332444120167322234504501639052704576058561765627438098752323442002866129234686728248058149294686974734863237492928397175317544358452938151933557861803500069719437211045883256667
Will not decrypt the ciphertext. Try Again
Give me ciphertext to decrypt: 1964796117077773118279971191453025140143564491691351523875625449605252500521705764861059080240241111254864761155826847373675311483245803688764059183317428226477410447638932637795546052538990857082617258979887071873413765648885878342808694744180256384014933594204784605061832642928700273222090144392972211211720694881007361469475488299963630605820194248340348164081034164687910009561192629601382921745244230145057227869738639736870219913390425692973457390871835937369208961514418481438153466942297189706351346228777706893555242038622135283856360363229826911960743994493999215936884094456894543873667127411067968937156
Here you go: 580550060391700078946913236734911770139931497702556153513487440893406629034802718534645538074938502890769281669222390720762
Give me ciphertext to decrypt:


PYTHON
-----------------------------------------------------------------------------------
┌──(kali㉿kali)-[~]
└─$ python3 
Python 3.9.8 (main, Nov  7 2021, 15:47:09) 
[GCC 11.2.0] on linux
Type "help", "copyright", "credits" or "license" for more information.
>>> from Crypto.Util.number import long_to_bytes
>>> 
>>> n = 112907822242451296917676048018400996425281409975529707139869250347104961289704198494730939459405888872044380040266711911630406472014199906846492479077809502733168208796710006743501821732158122410708851299109278185721511356098603228335796244141258119829206541735501307744326527139749660186242983991736060057817
>>> e = 65537
>>> c = 70338334668153031587170561990034911675519867043548011437427936338101374270908715553123927576151084025460206446656354937442979002172332444120167322234504501639052704576058561765627438098752323442002866129234686728248058149294686974734863237492928397175317544358452938151933557861803500069719437211045883256667
>>> x = pow(2, e, n)
>>> x
27933503492049130381969657996857301326301177316764753368034763756960531483833038281919407282934828904819869626755303546047730322506901866379309831089851835947385908966765690512118945774787728263587283415344203519787393187299257580572735143396580419186693058549513177350643183153727654733172428479857544451468
>>> c * x
1964796117077773118279971191453025140143564491691351523875625449605252500521705764861059080240241111254864761155826847373675311483245803688764059183317428226477410447638932637795546052538990857082617258979887071873413765648885878342808694744180256384014933594204784605061832642928700273222090144392972211211720694881007361469475488299963630605820194248340348164081034164687910009561192629601382921745244230145057227869738639736870219913390425692973457390871835937369208961514418481438153466942297189706351346228777706893555242038622135283856360363229826911960743994493999215936884094456894543873667127411067968937156
>>> m = 580550060391700078946913236734911770139931497702556153513487440893406629034802718534645538074938502890769281669222390720762 // 2
>>> long_to_bytes(m)
b'picoCTF{m4yb3_Th0se_m3s54g3s_4r3_difurrent_4005534}'
-----------------------------------------------------------------------------------


Flag: picoCTF{m4yb3_Th0se_m3s54g3s_4r3_difurrent_4005534}
```

## Notas adicionales
```
NOTA: Usando Python requerimos la libreria pycryptodome

c -> texto cifrado
m -> mensaje
p -> primo 1
q -> primo 2
n -> modulo
tn -> totient n (euler)
e -> exponente (llave publica, generalmente 2^16+1=65537)
d -> llave privada

n = p * q
tn = (p-1)*(q-1)
d = e mod inv tn -> inverse(e, tn) -> Libreria de Crypto.Util.number

Encriptacion:
c = m^e mod n -> pow(m,e,n)

Desencriptacion:
m = c^d mod n -> pow(c,d,n)

Convertir m a texto plano
long_to_bytes(m) -> Libreria de Crypto.Util.number



HOMOMORFICO:
encriptar(m1) * encriptar(m2) = encriptar(m1 * m2)
```

## Referencias
- https://en.wikipedia.org/wiki/Padding_oracle_attack
- https://es.wikipedia.org/wiki/Cifrado_homomórficoH
